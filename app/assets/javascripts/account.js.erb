var AccountsPage = (function() {

  function AccountsPage(panCardUploadBoxName, addressProofUploadBoxName, currentAddressProofUploadBoxName, current_address_checkbox, permanent_address_container, current_address_container, pancard_warn_text) {

    this.panCardUploadBoxName = "#" + panCardUploadBoxName;
    this.addressProofUploadBoxName= "#" + addressProofUploadBoxName;
    this.currentAddressProofUploadBoxName= "#" + currentAddressProofUploadBoxName;

    this.pancardDropzone = null;
    this.addressProofDropzone = null;
    this.currentAddressProofDropzone = null;

    this.$current_address_checkbox = current_address_checkbox;
    this.$permanent_address_container = permanent_address_container;
    this.$current_address_container = current_address_container;
    this.$pancard_warn_text = pancard_warn_text;

  }

  AccountsPage.prototype.createDropZonesForUpload = function() {
    this.pancardDropzone = new Dropzone(this.panCardUploadBoxName, {
      maxFilesize: 2, // MB
      maxFiles: 1,
      addRemoveLinks: true,
      paramName: "user[pan_card_copy]",
    });

    this.addressProofDropzone = new Dropzone(this.addressProofUploadBoxName, {
      maxFilesize: 2, // MB
      maxFiles: 1,
      addRemoveLinks: true,
      paramName: "address[address_proof]",
    });

    this.currentAddressProofDropzone = new Dropzone(this.currentAddressProofUploadBoxName, {
      maxFilesize: 2, // MB
      maxFiles: 1,
      addRemoveLinks: true,
      paramName: "address[address_proof]",
    });
  };

  AccountsPage.prototype.bindEventsForDropzones = function() {
    var _this = this;
    this.pancardDropzone.on('success', function() {
      alert('Your pancard copy is successfully uploaded.');
      _this.$pancard_warn_text.removeClass('text-warning').text('Your image uploaded successfully.')
      this.disable();
    });

    this.addressProofDropzone.on('success', function() {
      alert('Your address proof copy is successfully uploaded.');
      this.disable();
    });
    this.addressProofDropzone.on('error', function() {
      alert('Not able to upload your permanent address proof.');
      this.reset();
    });

    this.currentAddressProofDropzone.on('success', function() {
      alert('Your current address proof copy is successfully uploaded.');
      this.disable();
    });
    this.currentAddressProofDropzone.on('error', function() {
      alert('Not able to upload your current address proof.');
      this.reset();
    });
  };

  AccountsPage.prototype.bindEventsForCurrentAddressCheckbox = function() {
    var _this = this;

    this.$current_address_checkbox.change(function() {
      if(this.checked) {
        
        parentElements = _this.$permanent_address_container.find('input,textarea');
        childElements = _this.$current_address_container.find('input,textarea');

        //TODO: OPTIMIZE ME
        _this.$current_address_container.find('.full-address-field').val(_this.$permanent_address_container.find('.full-address-field').val());
        _this.$current_address_container.find('.city-field').val(_this.$permanent_address_container.find('.city-field').val());
        _this.$current_address_container.find('.state-field').val(_this.$permanent_address_container.find('.state-field').val());
        _this.$current_address_container.find('.pincode-field').val(_this.$permanent_address_container.find('.pincode-field').val());
        _this.$current_address_container.find('.country-field').val(_this.$permanent_address_container.find('.country-field').val());
      }
    });
  };

  AccountsPage.prototype.bindEvents = function() {
    this.bindEventsForDropzones();
    this.bindEventsForCurrentAddressCheckbox();

  };

  //Return the class
  return AccountsPage;
})();

$(function() {
  var $dropboxes = $('.dropbox'),
      $current_address_checkbox = $('#current_address_checkbox'),
      $permanent_address_container = $('.primary-address'),
      $current_address_container = $('.current-address'),
      accountsPage = new AccountsPage('pancard_upload', 'primary_address_proof_upload', 'current_address_proof_upload', $current_address_checkbox, $permanent_address_container, $current_address_container, $('#user_pan_card').find('p.text-warning'));

  try {
    accountsPage.createDropZonesForUpload();
    accountsPage.bindEvents();
  } catch(err) {
    console.log(err)
  }
});
